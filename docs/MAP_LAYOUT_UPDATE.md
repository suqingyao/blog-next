# åœ°å›¾é¡µé¢ Layout æ›´æ–°

## ğŸ¯ éœ€æ±‚

- âŒ å»æ‰è¿”å›æŒ‰é’®ï¼ˆMapBackButtonï¼‰
- âœ… ä½¿ç”¨ä¸»åº”ç”¨çš„ layoutï¼ˆä¸å†å…¨å±è¦†ç›–ï¼‰
- âœ… ä¿æŒå…¶ä»–åŠŸèƒ½ä¸å˜

## ğŸ“ ä¿®æ”¹å†…å®¹

### 1. åˆ é™¤è‡ªå®šä¹‰ layout

**æ–‡ä»¶ï¼š** `src/app/map/layout.tsx`

**ä¹‹å‰ï¼š**
```tsx
export default function MapLayout({ children }: { children: React.ReactNode }) {
  return (
    <div className="fixed inset-0 z-50 bg-white dark:bg-zinc-950">
      {children}
    </div>
  );
}
```

**ç°åœ¨ï¼š** âŒ å·²åˆ é™¤ï¼Œä½¿ç”¨ä¸»åº”ç”¨ layout

### 2. ç§»é™¤ MapBackButton ç»„ä»¶

**æ–‡ä»¶ï¼š** `src/components/site/MapLibreMap.tsx`

**ä¹‹å‰ï¼š**
```tsx
import { MapBackButton } from '@/components/site/MapBackButton';

return (
  <div className="absolute h-screen w-full">
    <MapBackButton />
    <MapInfoPanel />
    ...
  </div>
);
```

**ç°åœ¨ï¼š**
```tsx
// å·²ç§»é™¤ MapBackButton å¯¼å…¥

return (
  <div className="relative h-[calc(100vh-4rem)] w-full">
    <MapInfoPanel />
    ...
  </div>
);
```

### 3. åˆ é™¤æœªä½¿ç”¨çš„ç»„ä»¶æ–‡ä»¶

**æ–‡ä»¶ï¼š** `src/components/site/MapBackButton.tsx`

**çŠ¶æ€ï¼š** âŒ å·²åˆ é™¤ï¼ˆä¸å†éœ€è¦ï¼‰

### 4. è°ƒæ•´å®¹å™¨æ ·å¼

**ä¸»è¦å˜åŒ–ï¼š**

| å±æ€§ | ä¹‹å‰ | ç°åœ¨ | è¯´æ˜ |
|-----|------|------|------|
| **position** | `absolute` | `relative` | é€‚é…ä¸» layout |
| **é«˜åº¦** | `h-screen` | `h-[calc(100vh-4rem)]` | é¢„ç•™å¯¼èˆªæ ç©ºé—´ |
| **z-index** | 50ï¼ˆå…¨å±ï¼‰ | æ— ï¼ˆæ­£å¸¸æµï¼‰ | ä¸å†è¦†ç›– |

## ğŸ¨ è§†è§‰æ•ˆæœå¯¹æ¯”

### ä¹‹å‰ï¼ˆå…¨å±æ¨¡å¼ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    [â† è¿”å›æŒ‰é’®]      â”‚  <- è‡ªå®šä¹‰è¿”å›æŒ‰é’®
â”‚                     â”‚
â”‚     åœ°å›¾å…¨å±        â”‚  <- è¦†ç›–æ•´ä¸ªå±å¹•
â”‚                     â”‚
â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç°åœ¨ï¼ˆä¸» Layout æ¨¡å¼ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸»åº”ç”¨å¯¼èˆªæ       â”‚  <- ä¿ç•™å¯¼èˆª
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   [â„¹ï¸ ä¿¡æ¯é¢æ¿]      â”‚
â”‚                     â”‚
â”‚      åœ°å›¾åŒºåŸŸ       â”‚  <- é€‚åº”ä¸» layout
â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ é«˜åº¦è®¡ç®—è¯´æ˜

**`h-[calc(100vh-4rem)]`ï¼š**
- `100vh` - æ•´ä¸ªè§†å£é«˜åº¦
- `-4rem` - å‡å»å¯¼èˆªæ é«˜åº¦ï¼ˆ64pxï¼‰
- ç»“æœï¼šåœ°å›¾å æ®å¯¼èˆªæ ä¸‹æ–¹çš„å…¨éƒ¨ç©ºé—´

å¦‚æœä½ çš„å¯¼èˆªæ é«˜åº¦ä¸åŒï¼Œå¯ä»¥è°ƒæ•´è¿™ä¸ªå€¼ï¼š
```tsx
// 3rem = 48px
className="h-[calc(100vh-3rem)]"

// 5rem = 80px
className="h-[calc(100vh-5rem)]"
```

## âœ… ä¿ç•™çš„åŠŸèƒ½

æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å®Œå…¨ä¿ç•™ï¼š

1. âœ… **PhotoMarkerPin** - å•ç…§ç‰‡æ ‡è®°
2. âœ… **ClusterMarker** - èšç±»æ ‡è®°
3. âœ… **CustomMapControls** - å·¦ä¸‹è§’æ§åˆ¶
4. âœ… **MapInfoPanel** - ä¿¡æ¯é¢æ¿
5. âœ… **URL çŠ¶æ€ç®¡ç†** - `?photoId=xxx`
6. âœ… **HoverCard äº¤äº’**
7. âœ… **åŠ¨ç”»æ•ˆæœ**
8. âœ… **çŸ¢é‡ç“¦ç‰‡åœ°å›¾**

å”¯ä¸€çš„å˜åŒ–ï¼š
- âŒ MapBackButtonï¼ˆå·²ç§»é™¤ï¼‰
- âœ… ä½¿ç”¨ä¸»åº”ç”¨å¯¼èˆªæ è¿›è¡Œé¡µé¢åˆ‡æ¢

## ğŸ”„ ç”¨æˆ·ä½“éªŒå˜åŒ–

### å¯¼èˆªæ–¹å¼

**ä¹‹å‰ï¼š**
```
åœ°å›¾é¡µé¢ -> ç‚¹å‡»"è¿”å›"æŒ‰é’® -> ä¸Šä¸€é¡µ
```

**ç°åœ¨ï¼š**
```
åœ°å›¾é¡µé¢ -> ç‚¹å‡»ä¸»å¯¼èˆªæ çš„ä»»æ„é“¾æ¥ -> å…¶ä»–é¡µé¢
```

### ä¼˜åŠ¿

1. âœ… **ä¸€è‡´çš„å¯¼èˆªä½“éªŒ** - æ‰€æœ‰é¡µé¢ä½¿ç”¨ç›¸åŒçš„å¯¼èˆªæ 
2. âœ… **æ›´å¥½çš„é¡µé¢å±‚æ¬¡** - åœ°å›¾æ˜¯åº”ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œè€Œéç‹¬ç«‹å…¨å±
3. âœ… **ç®€åŒ–äº¤äº’** - æ— éœ€ä¸“é—¨çš„è¿”å›æŒ‰é’®
4. âœ… **ç¬¦åˆå¸¸è§„ä¹ æƒ¯** - å¤§å¤šæ•°åº”ç”¨éƒ½æ˜¯è¿™æ ·çš„

## ğŸ“ æ–‡ä»¶ç»“æ„ï¼ˆæ›´æ–°åï¼‰

```
src/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ map/
â”‚       â”œâ”€â”€ page.tsx              # åœ°å›¾é¡µé¢
â”‚       â””â”€â”€ layout.tsx            # âŒ å·²åˆ é™¤
â”œâ”€â”€ components/site/
â”‚   â”œâ”€â”€ MapLibreMap.tsx           # âœ… ä¸»åœ°å›¾ç»„ä»¶ï¼ˆå·²æ›´æ–°ï¼‰
â”‚   â”œâ”€â”€ MapClient.tsx             # âœ… å®¢æˆ·ç«¯åŒ…è£…
â”‚   â”œâ”€â”€ MapBackButton.tsx         # âŒ å·²åˆ é™¤
â”‚   â”œâ”€â”€ MapInfoPanel.tsx          # âœ… ä¿¡æ¯é¢æ¿
â”‚   â””â”€â”€ map/
â”‚       â”œâ”€â”€ PhotoMarkerPin.tsx    # âœ… å•ç…§ç‰‡æ ‡è®°
â”‚       â”œâ”€â”€ ClusterMarker.tsx     # âœ… èšç±»æ ‡è®°
â”‚       â””â”€â”€ CustomMapControls.tsx # âœ… è‡ªå®šä¹‰æ§åˆ¶
â””â”€â”€ lib/
    â”œâ”€â”€ map-clustering.ts         # âœ… èšç±»ç®—æ³•
    â””â”€â”€ map-style.ts              # âœ… åœ°å›¾æ ·å¼
```

## ğŸš€ å¦‚æœéœ€è¦è°ƒæ•´é«˜åº¦

å¦‚æœåœ°å›¾æ˜¾ç¤ºä¸æ­£ç¡®ï¼Œå¯ä»¥è°ƒæ•´å®¹å™¨é«˜åº¦ï¼š

```tsx
// MapLibreMap.tsx

// é€‰é¡¹ 1: å›ºå®šé«˜åº¦
<div className="relative h-screen w-full">

// é€‰é¡¹ 2: å‡å»å¯¼èˆªæ ï¼ˆæ¨èï¼‰
<div className="relative h-[calc(100vh-4rem)] w-full">

// é€‰é¡¹ 3: å‡å»å¯¼èˆªæ å’Œé¡µè„š
<div className="relative h-[calc(100vh-8rem)] w-full">

// é€‰é¡¹ 4: ä½¿ç”¨ Tailwind ç±»
<div className="relative min-h-screen w-full">
```

## ğŸ¯ æµ‹è¯•æ¸…å•

- [x] ç¼–è¯‘é€šè¿‡ âœ…
- [x] åœ°å›¾æ­£å¸¸æ˜¾ç¤º âœ…
- [x] ä¸»å¯¼èˆªæ å¯è§ âœ…
- [x] æ— è¿”å›æŒ‰é’® âœ…
- [x] PhotoMarkerPin å·¥ä½œ âœ…
- [x] ClusterMarker å·¥ä½œ âœ…
- [x] CustomMapControls å·¥ä½œ âœ…
- [x] MapInfoPanel æ˜¾ç¤º âœ…
- [x] URL çŠ¶æ€ç®¡ç†å·¥ä½œ âœ…
- [x] HoverCard äº¤äº’æ­£å¸¸ âœ…

## ğŸ“Š ä»£ç å˜åŒ–ç»Ÿè®¡

| é¡¹ç›® | å˜åŒ– |
|-----|------|
| åˆ é™¤æ–‡ä»¶ | 2 ä¸ª |
| ä¿®æ”¹æ–‡ä»¶ | 1 ä¸ª |
| åˆ é™¤è¡Œæ•° | ~25 è¡Œ |
| ä¿®æ”¹è¡Œæ•° | 3 è¡Œ |

## ğŸ‰ å®Œæˆ

ç°åœ¨åœ°å›¾é¡µé¢ï¼š
- âœ… ä½¿ç”¨ä¸»åº”ç”¨ layout
- âœ… æ˜¾ç¤ºä¸»å¯¼èˆªæ 
- âœ… æ— ç‹¬ç«‹è¿”å›æŒ‰é’®
- âœ… æ‰€æœ‰åœ°å›¾åŠŸèƒ½æ­£å¸¸
- âœ… æ›´ç¬¦åˆåº”ç”¨æ•´ä½“è®¾è®¡

---

**æ›´æ–°æ—¶é—´ï¼š** 2026-01-07
**æ›´æ–°è€…ï¼š** @suqingyao + Droid AI Assistant
